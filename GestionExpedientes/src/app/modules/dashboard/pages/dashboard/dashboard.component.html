<div class="bg-gray-100 p-6 space-y-2">

  <!-- Breadcrumb -->
  <div class="text-sm text-gray-600 mb-4">
    <span class="text-[#004C77] font-semibold">Inicio</span> &gt;
    <span class="text-[#F36C21] font-semibold">Dashboard</span>
  </div>

  <!-- Título -->
  <div class="flex justify-between items-center mb-2">
    <h1 class="text-2xl font-bold text-[#004C77]">Dashboard</h1>
  </div>
  <hr class="border-t-2 border-[#004C77] rounded-full mb-6" />

  <!-- KPI empresarial final con iconos a la derecha -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">

    <!-- Total -->
    <div [ngClass]="{ 'card-activa-total': estadoSeleccionado === 'TOTAL' }" (click)="filtrarPorEstado('TOTAL')"
      class="relative bg-gray-50 border border-gray-200 rounded-lg p-5 flex flex-col justify-between shadow-sm cursor-pointer hover:shadow-md transition">
      <div class="absolute top-0 left-0 w-full h-1 bg-[#004C77] rounded-t-lg"></div>
      <p class="text-4xl font-bold text-gray-800 leading-none">{{ totalExpedientes }}</p>
      <div class="flex items-center justify-between mt-2">
        <p class="text-sm text-[#004C77] font-medium">Total de Expedientes</p>
        <mat-icon class="icon-total text-base !text-[20px]">folder_open</mat-icon>
      </div>
    </div>

    <!-- Pendientes -->
    <div [ngClass]="{
    'card-activa-pendiente': estadoSeleccionado === 'PENDIENTE'
  }" (click)="filtrarPorEstado('PENDIENTE')"
      class="relative bg-gray-50 border border-gray-200 rounded-lg p-5 flex flex-col justify-between shadow-sm cursor-pointer hover:shadow-md transition">
      <div class="absolute top-0 left-0 w-full h-1 bg-yellow-500 rounded-t-lg"></div>
      <p class="text-4xl font-bold text-gray-800 leading-none">{{ totalPendientes }}</p>
      <div class="flex items-center justify-between mt-2">
        <p class="text-sm text-gray-700 font-medium">Expedientes Pendientes</p>
        <mat-icon class="icon-pendiente !text-[20px]">hourglass_empty</mat-icon>
      </div>
    </div>

    <!-- Aprobados -->
    <div [ngClass]="{
    'card-activa-aprobado': estadoSeleccionado === 'APROBADO'
  }" (click)="filtrarPorEstado('APROBADO')"
      class="relative bg-gray-50 border border-gray-200 rounded-lg p-5 flex flex-col justify-between shadow-sm cursor-pointer hover:shadow-md transition">
      <div class="absolute top-0 left-0 w-full h-1 bg-green-600 rounded-t-lg"></div>
      <p class="text-4xl font-bold text-gray-800 leading-none">{{ totalAprobados }}</p>
      <div class="flex items-center justify-between mt-2">
        <p class="text-sm text-gray-700 font-medium">Expedientes Aprobados</p>
        <mat-icon class="icon-aprobado !text-[20px]">check_circle</mat-icon>
      </div>
    </div>

    <!-- Rechazados -->
    <div [ngClass]="{ 'card-activa-rechazado': estadoSeleccionado === 'RECHAZADO' }"
      (click)="filtrarPorEstado('RECHAZADO')"
      class="relative bg-gray-50 border border-gray-200 rounded-lg p-5 flex flex-col justify-between shadow-sm cursor-pointer hover:shadow-md transition">
      <div class="absolute top-0 left-0 w-full h-1 bg-red-600 rounded-t-lg"></div>
      <p class="text-4xl font-bold text-gray-800 leading-none">{{ totalRechazados }}</p>
      <div class="flex items-center justify-between mt-2">
        <p class="text-sm text-gray-700 font-medium">Expedientes Rechazados</p>
        <mat-icon class="icon-rechazado !text-[20px]">cancel</mat-icon>
      </div>
    </div>

    <!-- Anulados -->
    <div [ngClass]="{ 'card-activa-anulado': estadoSeleccionado === 'ANULADO' }" (click)="filtrarPorEstado('ANULADO')"
      class="relative bg-gray-50 border border-gray-200 rounded-lg p-5 flex flex-col justify-between shadow-sm cursor-pointer hover:shadow-md transition">
      <div class="absolute top-0 left-0 w-full h-1 bg-gray-500 rounded-t-lg"></div>
      <p class="text-4xl font-bold text-gray-800 leading-none">{{ totalAnulados }}</p>
      <div class="flex items-center justify-between mt-2">
        <p class="text-sm text-gray-700 font-medium">Expedientes Anulados</p>
        <mat-icon class="icon-anulado !text-[20px]">block</mat-icon>
      </div>
    </div>


  </div>


  <!-- Tabs -->
  <mat-tab-group class="!text-[#004C77]">
    <!-- EXPEDIENTES -->

    <mat-tab label="Expedientes">
      <div class="mt-6">
        <div class="flex flex-col md:flex-row md:items-end gap-4 mb-6">

          <!-- Selector de campo -->
          <div class="flex-1 px-1">
            <label class="block text-xs font-semibold text-gray-700 mb-1">Buscar por</label>
            <select matTooltip="Seleccione el campo a buscar" [(ngModel)]="filtroCampo"
              (change)="onCambioCampoBusqueda()"
              class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white focus:ring-2 focus:ring-[#004C77] focus:outline-none cursor-pointer hover:ring-1 hover:ring-[#004C77]">
              <option value="" disabled selected>Seleccione campo</option>
              <option value="codigo">Código</option>
              <option value="asunto">Asunto</option>
              <option value="emisoresNombres">Emisores</option>
              <option value="destinatariosNombres">Destinatarios</option>
            </select>
          </div>

          <!-- Input de texto -->
          <div class="flex-1">
            <label class="block text-xs font-semibold text-gray-700 mb-1">Texto</label>
            <input matTooltip="Ingrese texto a buscar" [(ngModel)]="filtroTexto" (input)="aplicarFiltros()" type="text"
              placeholder="Buscar..."
              class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white focus:ring-2 focus:ring-[#004C77] focus:outline-none hover:ring-1 hover:ring-[#004C77]" />
          </div>

          <!-- Tipo de expediente -->
          <div class="w-40">
            <label class="block text-xs font-semibold text-gray-700 mb-1">Tipo</label>
            <select matTooltip="Filtrar por tipo de expediente" [(ngModel)]="filtroTipo" (change)="aplicarFiltros()"
              class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white focus:ring-2 focus:ring-[#004C77] focus:outline-none cursor-pointer hover:ring-1 hover:ring-[#004C77]">
              <option value="">Todos</option>
              <option value="Emisor">Emisor</option>
              <option value="Receptor">Receptor</option>
            </select>
          </div>

          <!-- Reservado -->
          <div class="w-40">
            <label class="block text-xs font-semibold text-gray-700 mb-1">Reservado</label>
            <select matTooltip="Filtrar por reservado" [(ngModel)]="filtroReservado" (change)="aplicarFiltros()"
              class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white focus:ring-2 focus:ring-[#004C77] focus:outline-none cursor-pointer hover:ring-1 hover:ring-[#004C77]">
              <option value="">Todos</option>
              <option value="true">Sí</option>
              <option value="false">No</option>
            </select>
          </div>

          <!-- Botón Limpiar -->
          <div class="pt-6">
            <mat-icon matTooltip="Limpiar todos los filtros"
              class="text-gray-500 cursor-pointer hover:text-red-500 transition-colors duration-200"
              (click)="limpiarFiltros()">close</mat-icon>
          </div>


        </div>

        <!-- CONTENEDOR TABLA -->
        <div
          class="flex flex-col bg-white border border-gray-200 rounded-md shadow-md overflow-hidden h-[45vh] min-h-[285px]">
          <!-- ENCABEZADO FIJO + SCROLL -->
          <div class="flex-1 overflow-y-auto">
            <table class="w-full text-sm border-collapse relative">
              <thead class="sticky top-0 z-10 bg-[#004C77] text-white uppercase text-xs tracking-wider shadow-sm">
                <tr>
                  <th class="px-4 py-3 text-left border-b-2 border-[#003a5a]">Código</th>
                  <th class="px-4 py-3 text-left border-b-2 border-[#003a5a]">Asunto</th>
                  <th class="px-4 py-3 text-left border-b-2 border-[#003a5a]">Proyecto</th>
                  <th class="px-4 py-3 text-left border-b-2 border-[#003a5a]">Fecha</th>
                  <th class="px-4 py-3 text-left border-b-2 border-[#003a5a]">Tipo</th>
                  <th class="px-4 py-3 text-left border-b-2 border-[#003a5a]">Estado</th>
                  <th class="px-4 py-3 text-left border-b-2 border-[#003a5a]">Comentario</th>
                  <th class="px-4 py-3 text-left border-b-2 border-[#003a5a]">Referencias</th>
                  <th class="px-4 py-3 text-left border-b-2 border-[#003a5a]">Reservado</th>
                  <th class="px-4 py-3 text-left border-b-2 border-[#003a5a]">Emisores</th>
                  <th class="px-4 py-3 text-left border-b-2 border-[#003a5a]">Destinatarios</th>
                  <th class="px-4 py-3 text-center border-b-2 border-[#003a5a]">Acciones</th>
                </tr>
              </thead>

              <tbody *ngIf="dataSourceExpedientes.data.length > 0; else sinExpedientes">
                <tr
                  *ngFor="let exp of dataSourceExpedientes.data | slice:(page-1)*pageSize:(page-1)*pageSize+pageSize; let i = index"
                  class="border-b border-gray-200 hover:bg-[#F8FBFD] transition-all duration-150">
                  <td class="px-4 py-3 text-gray-700">{{ exp.codigo }}</td>
                  <td class="px-4 py-3 font-medium text-gray-800">{{ exp.asunto }}</td>
                  <td class="px-4 py-3 text-gray-600">{{ exp.proyecto || '-' }}</td>
                  <td class="px-4 py-3 text-gray-600">{{ exp.fecha || '-' }}</td>
                  <td class="px-4 py-3 text-gray-600">{{ exp.tipoExpediente }}</td>
                  <td class="px-4 py-3">
                    <span class="px-2 py-1 rounded-full text-xs font-semibold" [ngClass]="{
                'bg-gray-200 text-gray-700': !exp.estado,
                'bg-yellow-100 text-yellow-800': exp.estado === 'PENDIENTE',
                'bg-green-100 text-green-800': exp.estado === 'APROBADO',
                'bg-red-100 text-red-800': exp.estado === 'RECHAZADO',
                'bg-gray-500 text-white': exp.estado === 'ANULADO'
              }">
                      {{ exp.estado || 'SIN ESTADO' }}
                    </span>
                  </td>
                  <td class="px-4 py-3 text-gray-600">{{ exp.comentario || '-' }}</td>
                  <td class="px-4 py-3 text-gray-600">{{ exp.referencias || '-' }}</td>
                  <td class="px-4 py-3 text-gray-600">{{ exp.reservado ? 'Sí' : 'No' }}</td>
                  <td class="px-4 py-3 text-gray-600">{{ exp.emisoresNombres }}</td>
                  <td class="px-4 py-3 text-gray-600">{{ exp.destinatariosNombres }}</td>
                  <td class="px-4 py-3 text-center">
                    <div class="flex justify-center gap-3">
                      <button (click)="abrirDetalle(exp)" matTooltip="Ver detalle"
                        class="text-[#004C77] hover:text-[#003655] transition cursor-pointer">
                        <mat-icon class="text-[19px]">visibility</mat-icon>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>

              <!-- PLANTILLA VACÍA -->
              <ng-template #sinExpedientes>
                <tbody>
                  <tr>
                    <td colspan="12" class="text-center text-gray-500 italic py-10 bg-[#F9FAFB]">
                      No hay expedientes registrados
                    </td>
                  </tr>
                </tbody>
              </ng-template>
            </table>
          </div>

          <!-- PAGINADOR -->
          <div
            class="flex justify-between items-center px-6 py-3 text-sm text-gray-700 bg-[#F6F8FA] border-t border-gray-300 rounded-b-md">
            <div>
              Mostrando
              <b>{{ (page - 1) * pageSize + 1 }}</b> -
              <b>{{
                Math.min(page * pageSize, dataSourceExpedientes.data.length)
                }}</b>
              de <b>{{ dataSourceExpedientes.data.length }}</b> registros
            </div>
            <div class="flex items-center gap-2">
              <button (click)="page = page > 1 ? page - 1 : 1" [disabled]="page === 1"
                class="px-3 py-1 text-[#004C77] border border-gray-300 rounded-md hover:bg-[#E5EDF3] disabled:opacity-50 transition-all cursor-pointer"
                matTooltip="Página anterior">
                ◀
              </button>
              <span class="text-gray-600 font-medium">Página {{ page }} / {{ totalPages }}</span>
              <button (click)="page = page < totalPages ? page + 1 : totalPages" [disabled]="page === totalPages"
                class="px-3 py-1 text-[#004C77] border border-gray-300 rounded-md hover:bg-[#E5EDF3] disabled:opacity-50 transition-all cursor-pointer"
                matTooltip="Página siguiente">
                ▶
              </button>
            </div>
          </div>
        </div>
      </div>
    </mat-tab>


    <!-- CARGOS -->
    <mat-tab label="Cargos Generados">
      <div class="mt-6">
        <table mat-table [dataSource]="dataSourceCargos" class="w-full text-sm">
          <ng-container matColumnDef="codigoCargo">
            <th mat-header-cell *matHeaderCellDef>Código</th>
            <td mat-cell *matCellDef="let c">{{ c.codigoCargo }}</td>
          </ng-container>
          <ng-container matColumnDef="fecha">
            <th mat-header-cell *matHeaderCellDef>Fecha</th>
            <td mat-cell *matCellDef="let c">{{ c.fecha }}</td>
          </ng-container>
          <ng-container matColumnDef="hora">
            <th mat-header-cell *matHeaderCellDef>Hora</th>
            <td mat-cell *matCellDef="let c">{{ c.hora }}</td>
          </ng-container>
          <ng-container matColumnDef="expediente">
            <th mat-header-cell *matHeaderCellDef>Expediente</th>
            <td mat-cell *matCellDef="let c">{{ c.expediente }}</td>
          </ng-container>
          <ng-container matColumnDef="acciones">
            <th mat-header-cell *matHeaderCellDef>Acciones</th>
            <td mat-cell *matCellDef="let c">
              <a [href]="c.archivo" target="_blank">
                <mat-icon matTooltip="Ver documento" class="cursor-pointer">visibility</mat-icon>
              </a>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsCargos"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsCargos;"></tr>
        </table>
        <mat-paginator #paginatorCargos [pageSize]="5"></mat-paginator>
      </div>
    </mat-tab>

    <!-- DOCUMENTOS -->
    <mat-tab label="Documentos">
      <div class="mt-6">
        <table mat-table [dataSource]="dataSourceDocumentos" class="w-full text-sm">
          <ng-container matColumnDef="nombre">
            <th mat-header-cell *matHeaderCellDef>Nombre</th>
            <td mat-cell *matCellDef="let d">{{ d.nombre }}</td>
          </ng-container>
          <ng-container matColumnDef="peso">
            <th mat-header-cell *matHeaderCellDef>Peso</th>
            <td mat-cell *matCellDef="let d">{{ d.peso }}</td>
          </ng-container>
          <ng-container matColumnDef="expediente">
            <th mat-header-cell *matHeaderCellDef>Expediente</th>
            <td mat-cell *matCellDef="let d">{{ d.expediente }}</td>
          </ng-container>
          <ng-container matColumnDef="acciones">
            <th mat-header-cell *matHeaderCellDef>Acciones</th>
            <td mat-cell *matCellDef="let d">
              <a [href]="d.url" target="_blank">
                <mat-icon matTooltip="Visualizar" class="cursor-pointer">visibility</mat-icon>
              </a>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsDocumentos"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsDocumentos;"></tr>
        </table>
        <mat-paginator #paginatorDocumentos [pageSize]="5"></mat-paginator>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>